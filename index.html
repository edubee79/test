<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>TOEIC Actual Test - Two Page Clear View</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background: #333; font-family: sans-serif; }
        .header-bar { height: 45px; background: #1a1a1a; color: #fff; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; }
        #timer { color: #00ff00; font-size: 22px; font-weight: bold; font-family: monospace; }
        .main-layout { display: flex; height: calc(100% - 45px); width: 100%; }

        /* 시험지 영역 (90%) */
        .viewer-container { width: 90%; height: 100%; display: flex; gap: 5px; padding: 5px; box-sizing: border-box; background: #525659; }

        /* SVG 페이지 박스 */
        .page-wrapper {
            flex: 1; height: 100%; background: white; 
            display: flex; justify-content: center; align-items: flex-start;
            overflow: hidden; border: 1px solid #000; position: relative;
        }

        /* SVG 출력용 컨테이너 */
        .svg-container { width: 100%; height: 100%; display: flex; justify-content: center; }
        svg { width: auto; height: 100%; } /* 높이에 맞춰 꽉 채움 */

        /* OMR 영역 (10%) */
        .omr-panel { width: 10%; height: 100%; background: #ffffff; border-left: 2px solid #222; overflow-y: auto; display: flex; flex-direction: column; align-items: center; padding: 15px 0; box-sizing: border-box; }
        .omr-row { margin-bottom: 6px; font-size: 12px; font-weight: bold; }
        .omr-row input { margin: 0 1px; cursor: pointer; width: 14px; height: 14px; }
        .btn { padding: 5px 12px; border-radius: 4px; cursor: pointer; font-weight: bold; border: none; }
        .btn-submit { background: #007bff; color: white; }
    </style>
</head>
<body>

<div class="header-bar">
    <div id="timer">00:00</div>
    <div style="font-size: 16px;">TOEIC Part 5 & 6 (SVG High-Res)</div>
    <button class="btn btn-submit" onclick="gradeTest()">채점 및 종료</button>
</div>

<div class="main-layout">
    <div class="viewer-container">
        <div class="page-wrapper"><div id="page-left" class="svg-container"></div></div>
        <div class="page-wrapper"><div id="page-right" class="svg-container"></div></div>
    </div>

    <div class="omr-panel" id="omr-list">
        <b>OMR CARD</b>
    </div>
</div>

<script>
    const answers = { 101:"1", 102:"2" /* ... 나머지 정답 ... */ };

    // 1. OMR 생성
    const omrList = document.getElementById('omr-list');
    for(let i=101; i<=146; i++) {
        omrList.innerHTML += `<div class="omr-row">${i}. <input type="radio" name="q${i}" value="1"><input type="radio" name="q${i}" value="2"><input type="radio" name="q${i}" value="3"><input type="radio" name="q${i}" value="4"></div>`;
    }

    // 2. 스톱워치
    let seconds = 0;
    setInterval(() => {
        seconds++;
        let m = Math.floor(seconds / 60); let s = seconds % 60;
        document.getElementById('timer').innerText = `${m < 10 ? '0'+m : m}:${s < 10 ? '0'+s : s}`;
    }, 1000);

    // 3. PDF 로드 및 SVG 렌더링 (선명도의 핵심)
    const pdfUrl = '/pdf-proxy/RC1-1part56.pdf?alt=media&token=deef03c4-c3f4-42d3-9399-18a57150fceb';
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

    async function loadPDF() {
        const loadingTask = pdfjsLib.getDocument(pdfUrl);
        const pdf = await loadingTask.promise;
        renderSVG(pdf, 1, 'page-left');
        renderSVG(pdf, 2, 'page-right');
    }

    async function renderSVG(pdf, num, containerId) {
        const page = await pdf.getPage(num);
        const container = document.getElementById(containerId);
        
        // 텍스트가 깨지지 않는 SVG 방식 사용
        const viewport = page.getViewport({ scale: 1.5 }); 
        const operatorList = await page.getOperatorList();
        const svgGfx = new pdfjsLib.SVGGraphics(page.commonObjs, page.objs);
        const svg = await svgGfx.getSVG(operatorList, viewport);
        
        container.appendChild(svg);
    }

    function gradeTest() {
        alert("채점 로직 실행..."); // 기존과 동일
    }

    loadPDF();
</script>
</body>
</html>
